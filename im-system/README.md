# SimpleIM - è½»é‡çº§å³æ—¶é€šè®¯ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº Go è¯­è¨€å®ç°çš„è½»é‡çº§ IM ç³»ç»Ÿï¼Œæ”¯æŒåƒäººåŒæ—¶åœ¨çº¿ï¼Œå¼€ç®±å³ç”¨ã€‚

[![Go](https://img.shields.io/badge/Go-1.21+-00ADD8?style=flat&logo=go)](https://golang.org)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

## âœ¨ ç‰¹æ€§

- ğŸš€ **è½»é‡é«˜æ•ˆ** - æ ¸å¿ƒä»£ç ç®€æ´ï¼Œå•èŠ‚ç‚¹æ”¯æŒä¸‡çº§è¿æ¥
- ğŸ’¬ **åŠŸèƒ½å®Œæ•´** - å•èŠã€ç¾¤èŠã€ç¦»çº¿æ¶ˆæ¯ã€æ¶ˆæ¯å·²è¯»ã€æ¶ˆæ¯æ’¤å›
- ğŸ“¦ **å¼€ç®±å³ç”¨** - Docker ä¸€é”®å¯åŠ¨ï¼Œè‡ªå¸¦ Web æ¼”ç¤ºé¡µé¢
- ğŸ”§ **æ˜“äºæ‰©å±•** - æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œæ–¹ä¾¿äºŒæ¬¡å¼€å‘

## ğŸ—ï¸ æ¶æ„

```
å®¢æˆ·ç«¯ (Web/App)
      â”‚
      â”‚ WebSocket
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway 1  â”‚â”€â”€â”€â”€â–¶â”‚  Gateway N  â”‚  â† æ— çŠ¶æ€ï¼Œå¯æ°´å¹³æ‰©å±•
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚   Redis Pub/Sub   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MySQL â”‚ Redis â”‚ MinIO â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/d60-lab/SimpleIM.git
cd SimpleIM/im-system

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
make up

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
make ps

# è®¿é—®æ¼”ç¤ºé¡µé¢
open http://localhost:8080/web/chat.html
```

### æœ¬åœ°å¼€å‘

```bash
# ä»…å¯åŠ¨ä¾èµ–æœåŠ¡ï¼ˆMySQLã€Redisã€MinIOã€MongoDBï¼‰
make deps

# è¿è¡Œ Gateway æœåŠ¡
make run

# æˆ–è€…ç›´æ¥è¿è¡Œ
go run cmd/gateway/main.go
```

### å¸¸ç”¨å‘½ä»¤

```bash
make help       # æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make up         # å¯åŠ¨æ‰€æœ‰æœåŠ¡
make down       # åœæ­¢æ‰€æœ‰æœåŠ¡
make logs       # æŸ¥çœ‹æ—¥å¿—
make build      # æ„å»º Docker é•œåƒ
make rebuild    # é‡æ–°æ„å»ºå¹¶å¯åŠ¨
make clean      # æ¸…ç†æ‰€æœ‰å®¹å™¨å’Œæ•°æ®
make swagger    # ç”Ÿæˆ Swagger æ–‡æ¡£
```

## ğŸ“¡ API æ–‡æ¡£

### Swagger UI

å¯åŠ¨æœåŠ¡åè®¿é—® Swagger æ–‡æ¡£ï¼š

```
http://localhost:8080/swagger/index.html
```

æ”¯æŒåœ¨çº¿æµ‹è¯•æ‰€æœ‰ API æ¥å£ã€‚

### ç”Ÿæˆæ–‡æ¡£

```bash
# å®‰è£… swag å·¥å…·ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
make swagger-install

# ç”Ÿæˆ/æ›´æ–° Swagger æ–‡æ¡£
make swagger
```

### API æ¥å£

### ç”¨æˆ·è®¤è¯

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/register` | ç”¨æˆ·æ³¨å†Œ |
| POST | `/api/login` | ç”¨æˆ·ç™»å½• |
| GET | `/api/user/info` | è·å–ç”¨æˆ·ä¿¡æ¯ |
| PUT | `/api/user/info` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |
| GET | `/api/users/:id` | æ ¹æ®IDè·å–ç”¨æˆ· |
| GET | `/api/users` | æœç´¢ç”¨æˆ· |

### ç¾¤ç»„ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/groups` | åˆ›å»ºç¾¤ç»„ |
| GET | `/api/groups/:id` | è·å–ç¾¤ä¿¡æ¯ |
| POST | `/api/groups/:id/join` | åŠ å…¥ç¾¤ç»„ |
| POST | `/api/groups/:id/leave` | é€€å‡ºç¾¤ç»„ |
| GET | `/api/groups/:id/members` | è·å–ç¾¤æˆå‘˜ |
| GET | `/api/user/groups` | è·å–æˆ‘çš„ç¾¤ç»„ |

### æ¶ˆæ¯å†å²

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | `/api/messages/group/:id` | è·å–ç¾¤èŠå†å² |
| GET | `/api/messages/private/:id` | è·å–ç§èŠå†å² |

### æ–‡ä»¶ä¸Šä¼ 

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | `/api/file/upload` | ä¸Šä¼ æ–‡ä»¶ |
| GET | `/api/file/info/:id` | è·å–æ–‡ä»¶ä¿¡æ¯ |
| GET | `/api/file/url/:id` | è·å–æ–‡ä»¶URL |
| GET | `/api/file/download/:id` | ä¸‹è½½æ–‡ä»¶ |
| DELETE | `/api/file/:id` | åˆ é™¤æ–‡ä»¶ |

### WebSocket

è¿æ¥åœ°å€: `ws://localhost:8080/ws?token=<JWT_TOKEN>`

æ¶ˆæ¯æ ¼å¼:
```json
{
  "type": 1,
  "to": "user_id",
  "content": { "text": "Hello!" },
  "timestamp": 1704067200000
}
```

æ¶ˆæ¯ç±»å‹:
| type | è¯´æ˜ |
|------|------|
| 1 | å•èŠæ¶ˆæ¯ |
| 2 | ç¾¤èŠæ¶ˆæ¯ |
| 4 | å›¾ç‰‡æ¶ˆæ¯ |
| 7 | æ–‡ä»¶æ¶ˆæ¯ |
| 30 | æ¶ˆæ¯ACK |
| 99 | å¿ƒè·³ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
im-system/
â”œâ”€â”€ cmd/gateway/          # æœåŠ¡å…¥å£
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ gateway/          # ç½‘å…³æ ¸å¿ƒï¼ˆè¿æ¥ç®¡ç†ã€æ¶ˆæ¯åˆ†å‘ï¼‰
â”‚   â”œâ”€â”€ service/          # ä¸šåŠ¡æœåŠ¡ï¼ˆç¾¤ç»„ã€ç¦»çº¿æ¶ˆæ¯ï¼‰
â”‚   â”œâ”€â”€ handler/          # HTTP æ¥å£
â”‚   â””â”€â”€ model/            # æ•°æ®æ¨¡å‹
â”œâ”€â”€ pkg/auth/             # JWT è®¤è¯
â”œâ”€â”€ web/                  # å‰ç«¯æ¼”ç¤ºé¡µé¢
â”œâ”€â”€ deploy/               # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ docs/                 # æ–‡æ¡£
â”‚   â””â”€â”€ blog.md          # æŠ€æœ¯åšæ–‡
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

## âš™ï¸ é…ç½®

### ç¯å¢ƒå˜é‡

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `NODE_ID` | node1 | èŠ‚ç‚¹ID |
| `MYSQL_HOST` | localhost | MySQL åœ°å€ |
| `MYSQL_PORT` | 3306 | MySQL ç«¯å£ |
| `MYSQL_USER` | root | MySQL ç”¨æˆ· |
| `MYSQL_PASSWORD` | password | MySQL å¯†ç  |
| `MYSQL_DATABASE` | im_db | æ•°æ®åº“å |
| `REDIS_HOST` | localhost | Redis åœ°å€ |
| `REDIS_PORT` | 6379 | Redis ç«¯å£ |
| `JWT_SECRET` | im-secret | JWT å¯†é’¥ |

## ğŸ“Š æ€§èƒ½

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å•èŠ‚ç‚¹è¿æ¥æ•° | 10,000+ |
| æ¶ˆæ¯å»¶è¿Ÿ (P99) | < 50ms |
| æ¶ˆæ¯ååé‡ | 10,000+ QPS |

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.21+
- **Webæ¡†æ¶**: Gin
- **WebSocket**: gorilla/websocket
- **æ•°æ®åº“**: MySQL 8.0
- **ç¼“å­˜**: Redis 7
- **å¯¹è±¡å­˜å‚¨**: MinIO
- **å®¹å™¨åŒ–**: Docker

## ğŸ“– æ–‡æ¡£

- [æŠ€æœ¯åšæ–‡](docs/blog.md) - è¯¦ç»†çš„è®¾è®¡æ€è·¯å’Œå®ç°è¯´æ˜

## ğŸ“„ License

MIT License